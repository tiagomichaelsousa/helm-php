name: Changelog

on:
  push:
    branches: [ main ]
    paths:
      - CHANGELOG.md
      - .github/workflows/changelog.yml
  pull_request:
    branches: [ main ]
    paths:
      - CHANGELOG.md
jobs:
  build:
    runs-on: ubuntu-latest

    if: github.repository == 'tiagomichaelsousa/helm-php'

    steps:
      - uses: actions/checkout@v2

      - name: Checkout
        uses: actions/checkout@v2

      - name: Read CHANGELOG.md
        id: package
        uses: juliangruber/read-file-action@v1
        with:
          path: ./CHANGELOG.md

      - name: Add file headers
        uses: DamianReeves/write-file-action@v1.0
        with:
          path: ./CHANGELOG.md
          contents: |
            ---
            title: Changelog
            description: Changelog
            ---
            ${{ steps.package.outputs.content }}

            ----

            Next section: [Upgrade Guide â†’](/docs/upgrade-guide)
          write-mode: overwrite

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.CHANGELOG_KEY }}
          commit-message: Update changelog.md
          committer: GitHub Action <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          title: 'Update changelog.md'
